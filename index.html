<!--
World Food & Breakfast Recipes - Single-file (index.html)
Updated to handle runtime errors when Firebase config is missing or placeholder values are left in place.

Fixes included in this version:
 - Guards against using Firestore/Storage/Auth when firebaseConfig still contains placeholders.
 - Provides a clear on-page warning and instructions if Firebase is not configured.
 - Avoids calling db.collection(...) etc. when Firebase is not properly initialized to prevent @firebase/firestore errors.
 - Wraps initialization in try/catch and checks for existing firebase apps to avoid double-init errors.
 - More defensive null checks when reading Firestore fields.

IMPORTANT: For full functionality (auth, uploads, comments) please replace the firebaseConfig object with your actual Firebase project values and enable Authentication (Google & Phone), Firestore, and Storage in the Firebase console.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World Food & Breakfast Recipes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Colorful remix header */
    .header-strip{display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;background: linear-gradient(90deg,#FF9A9E,#FAD0C4,#FBC2EB,#A6C0FE,#B2FEFA);box-shadow:0 6px 18px rgba(0,0,0,0.12);margin:15px 0}
    .logo-food{width:64px;height:64px;border-radius:12px;object-fit:cover}
    .hero-title{font-weight:700;font-size:1.5rem}
    .recipe-card img{height:180px;object-fit:cover;border-radius:8px}
    .glossy{filter: saturate(1.05) contrast(1.02);} .quote-card{background:rgba(255,255,255,0.85);border-radius:10px;padding:12px}
    footer{padding:20px 0;margin-top:30px} .uploader-box{background:linear-gradient(180deg,rgba(255,255,255,0.9),#fff);padding:15px;border-radius:10px}
    .warn{background:#fff3cd;border:1px solid #ffeeba;padding:10px;border-radius:6px;margin-bottom:12px}
  </style>
</head>
<body class="bg-light">
  <div class="container py-3">
    <div class="d-flex justify-content-between align-items-center">
      <div class="header-strip flex-grow-1 me-3">
        <img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&s=0c3a1e3a2c8b6a1bb3c0cb0f9c5f6c47" class="logo-food" alt="food">
        <div>
          <div class="hero-title">World Food & Breakfast Recipes</div>
          <div class="text-muted small">Explore glossy photos, upload your own recipes, and join the conversation</div>
        </div>
      </div>
      <div id="auth-area" class="text-end">
        <div id="user-info" style="display:none">
          <img id="user-pic" src="" alt="user" style="width:42px;height:42px;border-radius:50%;object-fit:cover;vertical-align:middle">
          <span id="user-name" class="ms-2"></span>
          <button id="logoutBtn" class="btn btn-sm btn-outline-secondary ms-2">Logout</button>
        </div>
        <div id="login-area">
          <button id="googleSignIn" class="btn btn-sm btn-primary">Sign in with Google</button>
          <button id="phoneSignInBtn" class="btn btn-sm btn-success ms-1">Sign in with Phone</button>
        </div>
      </div>
    </div>

    <nav class="navbar navbar-expand-lg bg-transparent mt-3">
      <div class="container-fluid px-0">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="#gallery">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#upload">Upload Recipe</a></li>
          <li class="nav-item"><a class="nav-link" href="#quotes">Famous Quotes</a></li>
        </ul>
      </div>
    </nav>

    <!-- Warning area for Firebase config -->
    <div id="firebaseWarning" style="display:none" class="warn"></div>

    <!-- Quotes -->
    <section id="quotes" class="mb-3">
      <div class="row">
        <div class="col-md-8">
          <div id="quotesCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              <div class="carousel-item active"><div class="quote-card">"One cannot think well, love well, sleep well, if one has not dined well." — Virginia Woolf</div></div>
              <div class="carousel-item"><div class="quote-card">"Cooking is like love: it should be entered into with abandon or not at all." — Harriet Van Horne</div></div>
              <div class="carousel-item"><div class="quote-card">"People who love to eat are always the best people." — Julia Child</div></div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#quotesCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
            <button class="carousel-control-next" type="button" data-bs-target="#quotesCarousel" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
          </div>
        </div>
        <div class="col-md-4 d-none d-md-block">
          <div class="card">
            <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=2c1b2c8a7c6d2ad0a4b1a3a1f7e8b2c3" class="card-img-top glossy" alt="breakfast">
            <div class="card-body"><h5 class="card-title">Featured Breakfast</h5><p class="card-text small text-muted">Today's highlight: Global morning favorites.</p></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Upload section -->
    <section id="upload" class="mb-4">
      <h4>Upload Your Recipe (Google or Phone login required)</h4>
      <div class="uploader-box">
        <form id="uploadForm">
          <div class="mb-2"><label class="form-label">Recipe Title</label><input id="recipeTitle" class="form-control" required></div>
          <div class="mb-2"><label class="form-label">Cuisine (e.g., Indian, French)</label><input id="recipeCuisine" class="form-control" required></div>
          <div class="mb-2"><label class="form-label">Description / Ingredients / Steps</label><textarea id="recipeDesc" class="form-control" rows="4" required></textarea></div>
          <div class="mb-2"><label class="form-label">Upload Image</label><input id="recipeImage" type="file" accept="image/*" class="form-control" required></div>
          <button id="uploadBtn" class="btn btn-primary">Upload Recipe</button>
        </form>
        <div id="uploadStatus" class="mt-2 small text-muted"></div>
      </div>
    </section>

    <!-- Gallery -->
    <section id="gallery">
      <h4>Famous World Recipes</h4>
      <div id="recipesGrid" class="row g-3">
        <!-- recipe cards injected here -->
      </div>
    </section>

    <!-- Recipe modal -->
    <div class="modal fade" id="recipeModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header"><h5 id="modalTitle" class="modal-title"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
          <div class="modal-body">
            <img id="modalImg" class="img-fluid rounded mb-3 glossy" src="" alt="">
            <p id="modalCuisine" class="text-muted"></p>
            <p id="modalDesc"></p><hr>
            <h6>Comments</h6>
            <div id="commentsList" class="mb-3"></div>
            <div id="commentFormArea"><textarea id="commentText" class="form-control mb-2" placeholder="Write a comment..."></textarea><button id="postCommentBtn" class="btn btn-sm btn-success">Post comment</button></div>
            <div id="modalMsg" class="mt-2 small text-muted"></div>
          </div>
        </div>
      </div>
    </div>

    <footer class="text-center text-muted"><small>Made with ❤️ — World Food & Breakfast Recipes (Demo). Replace Firebase config and enable services to use fully.</small></footer>
  </div>

  <!-- Firebase (compat) CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
   <!-- Firebase SDKs -->
  <script type="module">
    // Import Firebase core and Firestore SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    // ✅ Replace the placeholders below with your actual Firebase config from console
    const firebaseConfig = {
    apiKey: "AIzaSyCJw1WXuEt3T2hlaixljefX4z9IJ7miMs8",
  authDomain: "world-s-food-recipe.firebaseapp.com",
  projectId: "world-s-food-recipe",
  storageBucket: "world-s-food-recipe.firebasestorage.app",
  messagingSenderId: "693499310885",
  appId: "1:693499310885:web:2fb18dee278cca785c60cc",
  measurementId: "G-WNZDS592K3" 
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    document.getElementById("status").textContent = "✅ Firebase Connected!";

    // Handle Save Button
    const saveBtn = document.getElementById("saveBtn");
    const loadBtn = document.getElementById("loadBtn");
    const dataInput = document.getElementById("dataInput");
    const output = document.getElementById("output");

    // Save Data to Firestore
    saveBtn.addEventListener("click", async () => {
      const text = dataInput.value.trim();
      if (!text) return alert("Please enter some text!");
      try {
        await addDoc(collection(db, "messages"), { text });
        alert("✅ Data saved to Firestore!");
        dataInput.value = "";
      } catch (e) {
        console.error("Error adding document: ", e);
      }
    });

    // Load Data from Firestore
    loadBtn.addEventListener("click", async () => {
      output.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "messages"));
      querySnapshot.forEach((doc) => {
        const li = document.createElement("li");
        li.textContent = doc.data().text;
        output.appendChild(li);
      });
    });
    // ==================================================================

    // Simple check whether config looks replaced
    function isConfigReplaced(cfg){
      if(!cfg) return false;
      return Object.values(cfg).every(v => typeof v === 'string' && v && !v.startsWith('REPLACE'));
    }

    // Firebase variables (will be assigned only if config valid)
    let firebaseInitialized = false;
    let auth = null, db = null, storage = null;

    try{
      if(isConfigReplaced(firebaseConfig)){
        // Avoid double initialization if app already exists
        if(!firebase.apps || !firebase.apps.length){
          firebase.initializeApp(firebaseConfig);
        } else {
          // use existing app
          // firebase.app(); // already available via global
        }
        auth = firebase.auth();
        db = firebase.firestore();
        storage = firebase.storage();
        firebaseInitialized = true;
      } else {
        const warn = document.getElementById('firebaseWarning');
        warn.style.display = 'block';
        warn.innerHTML = '<strong>Firebase not configured.</strong> To enable login, uploads and comments: copy your Firebase project config into the <code>firebaseConfig</code> in this file and enable Authentication (Google + Phone), Firestore and Storage in the Firebase Console.';
        // disable auth UI buttons to avoid confusing errors
        document.getElementById('login-area').querySelectorAll('button').forEach(b=>b.disabled=true);
      }
    }catch(err){
      console.error('Firebase initialization error:',err);
      const warn = document.getElementById('firebaseWarning'); warn.style.display='block'; warn.textContent='Error initializing Firebase: '+(err && err.message ? err.message : err);
      document.getElementById('login-area').querySelectorAll('button').forEach(b=>b.disabled=true);
    }

    // UI elements
    const googleBtn = document.getElementById('googleSignIn');
    const phoneBtn = document.getElementById('phoneSignInBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const userInfo = document.getElementById('user-info');
    const loginArea = document.getElementById('login-area');
    const userPic = document.getElementById('user-pic');
    const userName = document.getElementById('user-name');

    const uploadForm = document.getElementById('uploadForm');
    const uploadStatus = document.getElementById('uploadStatus');
    const recipesGrid = document.getElementById('recipesGrid');

    const recipeModal = new bootstrap.Modal(document.getElementById('recipeModal'));
    let currentRecipeId = null;

    // If firebase not initialized, stub out safe default behaviors
    if(firebaseInitialized){
      // Auth state
      auth.onAuthStateChanged(user => {
        if(user){
          loginArea.style.display = 'none';
          userInfo.style.display = 'inline-block';
          userName.textContent = user.displayName || user.phoneNumber || user.email || 'User';
          userPic.src = user.photoURL || 'https://images.unsplash.com/photo-1545996124-1b4d0b8c2d6b?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&s=7b1a1f5b4c3e2d1a1b0c0d0e0f1a2b3c';
        } else {
          loginArea.style.display = 'inline-block';
          userInfo.style.display = 'none';
        }
      });

      // Google Sign-in
      googleBtn.addEventListener('click', async () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        try{ await auth.signInWithPopup(provider); }catch(err){alert('Google sign-in error: '+err.message)}
      });

      // Phone Sign-in (uses reCAPTCHA)
      phoneBtn.addEventListener('click', async () => {
        const phone = prompt('Enter phone number with country code (e.g. +9199...):'); if(!phone) return;
        // create/inject recaptcha container
        if(!document.getElementById('recaptcha-container')){ const rc = document.createElement('div'); rc.id='recaptcha-container'; document.body.appendChild(rc); }
        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {size:'invisible'});
        try{
          const confirmationResult = await auth.signInWithPhoneNumber(phone, window.recaptchaVerifier);
          const code = prompt('Enter the OTP sent to your phone:'); if(!code) throw new Error('OTP required');
          await confirmationResult.confirm(code);
        }catch(err){alert('Phone sign-in error: '+err.message)}
      });

      logoutBtn.addEventListener('click', () => auth.signOut());

      // Upload recipe
      uploadForm.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const user = auth.currentUser;
        if(!user){ alert('You must be signed in to upload a recipe.'); return; }
        const title = document.getElementById('recipeTitle').value.trim();
        const cuisine = document.getElementById('recipeCuisine').value.trim();
        const desc = document.getElementById('recipeDesc').value.trim();
        const imgFile = document.getElementById('recipeImage').files[0];
        if(!title||!cuisine||!desc||!imgFile){ alert('Please complete all fields.'); return; }

        uploadStatus.textContent = 'Uploading image...';
        const storageRef = storage.ref().child('recipes/'+Date.now()+'_'+imgFile.name);
        try{
          const uploadTask = await storageRef.put(imgFile);
          const url = await uploadTask.ref.getDownloadURL();
          uploadStatus.textContent = 'Saving recipe...';
          await db.collection('recipes').add({ title, cuisine, desc, imageUrl: url, createdAt: firebase.firestore.FieldValue.serverTimestamp(), userId: user.uid, userName: user.displayName||user.phoneNumber||user.email||'User' });
          uploadStatus.textContent = 'Uploaded successfully!';
          uploadForm.reset();
        }catch(err){ uploadStatus.textContent = 'Upload failed: '+err.message; }
      });

      // Load recipes (real-time)
      db.collection('recipes').orderBy('createdAt','desc').onSnapshot(snap=>{
        recipesGrid.innerHTML='';
        snap.forEach(doc=>{
          const r = doc.data() || {};
          const col = document.createElement('div'); col.className='col-md-4';
          col.innerHTML = `
            <div class="card recipe-card">
              <img src="${escapeHtml(r.imageUrl||'')}" class="card-img-top glossy" alt="${escapeHtml(r.title||'')}">
              <div class="card-body">
                <h5 class="card-title">${escapeHtml(r.title||'Untitled')}</h5>
                <p class="card-text small text-muted">${escapeHtml(r.cuisine||'Unknown')}</p>
                <p class="card-text">${truncate(escapeHtml(r.desc||''),100)}</p>
                <div class="d-flex justify-content-between align-items-center">
                  <button class="btn btn-sm btn-outline-primary viewBtn" data-id="${doc.id}">View</button>
                  <small class="text-muted">By ${escapeHtml(r.userName||'Guest')}</small>
                </div>
              </div>
            </div>
          `;
          recipesGrid.appendChild(col);
        });
        // attach view listeners
        document.querySelectorAll('.viewBtn').forEach(b=>b.addEventListener('click', ()=>openRecipeModal(b.dataset.id)));
      }, err=>{
        console.error('Error listening to recipes:', err);
        const warn = document.getElementById('firebaseWarning'); warn.style.display='block'; warn.textContent = 'Firestore listener error: '+(err && err.message ? err.message : err);
      });

      // Open modal & load comments
      async function openRecipeModal(id){
        currentRecipeId = id; try{
          const doc = await db.collection('recipes').doc(id).get();
          if(!doc.exists) return alert('Recipe not found');
          const r = doc.data() || {};
          document.getElementById('modalTitle').textContent = r.title || 'Untitled';
          document.getElementById('modalImg').src = r.imageUrl || '';
          document.getElementById('modalCuisine').textContent = 'Cuisine: '+(r.cuisine||'Unknown');
          document.getElementById('modalDesc').textContent = r.desc || '';
          document.getElementById('modalMsg').textContent = '';
          document.getElementById('commentText').value = '';
          const commentsList = document.getElementById('commentsList'); commentsList.innerHTML='Loading comments...';
          const snap = await db.collection('recipes').doc(id).collection('comments').orderBy('createdAt','asc').get();
          commentsList.innerHTML='';
          snap.forEach(cdoc=>{
            const c = cdoc.data() || {};
            const time = (c.createdAt && typeof c.createdAt.toDate === 'function') ? c.createdAt.toDate() : new Date();
            const el = document.createElement('div'); el.className='border rounded p-2 mb-2 bg-white';
            el.innerHTML = `<strong>${escapeHtml(c.userName||'Anon')}</strong> <small class="text-muted">${time.toLocaleString()}</small><div>${escapeHtml(c.text||'')}</div>`;
            commentsList.appendChild(el);
          });
          recipeModal.show();
        }catch(err){ console.error('Error loading recipe/comments:',err); alert('Error: '+(err && err.message?err.message:err)); }
      }

      // Post comment
      document.getElementById('postCommentBtn').addEventListener('click', async ()=>{
        const user = auth.currentUser; if(!user){ alert('Sign in to comment'); return; }
        const text = document.getElementById('commentText').value.trim(); if(!text) return;
        try{
          await db.collection('recipes').doc(currentRecipeId).collection('comments').add({ text, userId: user.uid, userName: user.displayName||user.phoneNumber||user.email||'User', createdAt: firebase.firestore.FieldValue.serverTimestamp() });
          document.getElementById('commentText').value='';
          document.getElementById('modalMsg').textContent='Comment posted.';
          // refresh comments
          openRecipeModal(currentRecipeId);
        }catch(err){ document.getElementById('modalMsg').textContent='Error: '+err.message; }
      });

      // Seed sample recipes if none exist (first load only) - non-destructive
      (async function seedIfEmpty(){
        try{
          const snap = await db.collection('recipes').limit(1).get();
          if(!snap.empty) return;
          const samples = [
            {title:'Classic Pancakes', cuisine:'American', desc:'Fluffy pancakes made with flour, milk, eggs. Serve with syrup.', imageUrl:'https://images.unsplash.com/photo-1550317138-10000687a72b?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=1f2d3e4c5b6a7a8b9c0d1e2f3a4b5c6d', userName:'Chef Demo'},
            {title:'Masala Dosa', cuisine:'Indian', desc:'Crispy rice crepe filled with spiced potato.', imageUrl:'https://images.unsplash.com/photo-1604908177522-3f7a1b5b3c4d?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d', userName:'Chef Demo'},
            {title:'French Croissant', cuisine:'French', desc:'Buttery laminated pastry, flaky and golden.', imageUrl:'https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=0c3a1e3a2c8b6a1bb3c0cb0f9c5f6c47', userName:'Chef Demo'}
          ];
          for(const s of samples){ await db.collection('recipes').add({...s, createdAt: firebase.firestore.FieldValue.serverTimestamp()}); }
        }catch(err){ console.error('Seed error:',err); }
      })();

    } else {
      // Firebase not initialized - provide static sample cards so UI still looks useful
      const samples = [
        {title:'Classic Pancakes', cuisine:'American', desc:'Fluffy pancakes made with flour, milk, eggs. Serve with syrup.', imageUrl:'https://images.unsplash.com/photo-1550317138-10000687a72b?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=1f2d3e4c5b6a7a8b9c0d1e2f3a4b5c6d', userName:'Chef Demo'},
        {title:'Masala Dosa', cuisine:'Indian', desc:'Crispy rice crepe filled with spiced potato.', imageUrl:'https://images.unsplash.com/photo-1604908177522-3f7a1b5b3c4d?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d', userName:'Chef Demo'},
        {title:'French Croissant', cuisine:'French', desc:'Buttery laminated pastry, flaky and golden.', imageUrl:'https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=0c3a1e3a2c8b6a1bb3c0cb0f9c5f6c47', userName:'Chef Demo'}
      ];
      recipesGrid.innerHTML='';
      samples.forEach(r=>{
        const col = document.createElement('div'); col.className='col-md-4';
        col.innerHTML = `
          <div class="card recipe-card">
            <img src="${escapeHtml(r.imageUrl)}" class="card-img-top glossy" alt="${escapeHtml(r.title)}">
            <div class="card-body">
              <h5 class="card-title">${escapeHtml(r.title)}</h5>
              <p class="card-text small text-muted">${escapeHtml(r.cuisine)}</p>
              <p class="card-text">${truncate(escapeHtml(r.desc),100)}</p>
              <div class="d-flex justify-content-between align-items-center">
                <button class="btn btn-sm btn-outline-primary" disabled>View</button>
                <small class="text-muted">By ${escapeHtml(r.userName)}</small>
              </div>
            </div>
          </div>
        `;
        recipesGrid.appendChild(col);
      });
      // disable upload form to avoid errors
      document.getElementById('uploadForm').querySelectorAll('input,textarea,button').forEach(el=>el.disabled=true);
    }

    // Utility helpers
    function escapeHtml(unsafe){ if(!unsafe) return ''; return String(unsafe).replace(/[&<>\"]+/g, function(s){return({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s])}); }
    function truncate(s,n){ if(!s) return ''; return s.length>n? s.slice(0,n)+'...':s; }

  </script>
</body>
</html>
